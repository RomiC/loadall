(function(a){a.fn.loadall=function(d){var e=a.extend({animation:450,image:null,backgroundColor:null,callback:null,debug:false},d);c.debug=e.debug;var f={content:"",sourcesNum:0};return this.each(function(){var d=a(this);a.extend(d,{_loader:a.extend(true,{},b)});d._loader.init({container:d,animation:e.animation,image:e.image,backgroundColor:e.backgroundColor});d._loader.show(function(){a.ajax({url:e.url,dataType:"html",success:function(b){f.content=b;a("*",b).each(function(){if(a(this).attr("src")){f.sourcesNum++;a(this).load(function(){c.out("%s loaded...",a(this).attr("src"));f.sourcesNum--;c.out("images left to load: %d",f.sourcesNum);if(f.sourcesNum==0){d._loader.hide(e.callback);d.html(f.content);c.out("everything loaded!")}})}});c.out("sources to load: %d",f.sourcesNum)},error:function(a,b,e){d._loader.hide(function(){alert("error...");c.out("%s: %s",b,e)})}})})})};var b={id:0,animation:400,container:null,obj:a("<div>").css({"background-position":"center center","background-repeat":"no-repeat",display:"none",position:"absolute","z-index":100}),init:function(b){var c=this;c.id="loader"+Math.floor(Math.random()*1e3);c.container=b.container;c.obj.attr("id",c.id).css({height:c.container.outerHeight()+"px",left:c.container.offset().left+"px",top:c.container.offset().top+"px",width:c.container.outerWidth()+"px"}).appendTo("body");if(b.backgroundColor)c.obj.css({"background-color":b.backgroundColor});if(b.image){c.obj.css({"background-image":"url('"+b.image+"')"});a("<img>").attr("src",b.image)}else{a("<div>").text("loading...").css({position:"relative","text-align":"center",top:Math.floor(c.container.height()/2)+"px",width:"100%"}).appendTo(c.obj)}if(b.animation)c.animation=b.animation},show:function(a){var b=this;b.obj.fadeIn(b.animation,function(){if(a)a.call(null)})},hide:function(a){var b=this;b.obj.fadeOut(b.animation,function(){if(a)a.call()})}};var c={debug:false,out:function(){if(this.debug&&window.console&&typeof window.console.log=="function")window.console.log.apply(window.console,arguments)}}})(jQuery)